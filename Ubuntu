FROM ubuntu:22.04

ARG USER_ID=1000
ARG USER="speechtotext"
ARG GROUP_ID=1000

# Package installation, add packages before &&
RUN apt-get update && apt-get install -qq -y --no-install-recommends \
    bash python3 ffmpeg python3-pip && \
    rm -rf /var/lib/apt/lists/*

# User creation
RUN groupadd -g ${GROUP_ID} ${USER} &&\
    useradd -m -u ${USER_ID} -g ${USER} -d /home/${USER} -s /bin/bash ${USER}
WORKDIR /home/${USER}

RUN mkdir /app /target /audio
COPY scripts/LLM_text_to_speech.py /app
# Install python modules for the user
RUN su - ${USER} -c "pip install --no-cache-dir --quiet openai-whisper"
RUN chown -R ${USER}:${USER} /app /target /audio


USER ${USER}
# Bash shell entrypoint for Gitlab pipeline
#ENTRYPOINT ["/bin/bash", "-l", "-c"]